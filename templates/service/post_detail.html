{% extends '../base.html' %}
{% load static %}
{% load humanize %}
{% block content %}
<style>
  #reply-input {
    border-radius: 1px;
    border-top: none;
    border-left: none;
    border-right: none;
  }
  .collapsible {
    cursor: pointer;
    border: none;
    text-align: left;
    outline: none;
    font-size: 15px;
  }
  .content {
    padding: 0 8%;
    max-height: 0;
    overflow: hidden;
    transition: max-height 0.2s ease-out;
  }
</style>
<main id="main">
  <!-- ======= Breadcrumbs ======= -->
  <section class="breadcrumbs">
    <div class="container">
      <ol>
        <li><a href="/">Casa</a></li>
        <li><a href="{% url 'all_posts' %}">Detalle</a></li>
      </ol>
      <h2>{{ product.title }}</h2>

    </div>
  </section><!-- End Breadcrumbs -->

  <!-- ======= Blog Single Section ======= -->
  <section id="blog" class="blog">
    <div class="container" data-aos="fade-up">

      <div class="row">

        <div class="col-lg-8 entries">

          <article class="entry entry-single">

            <div class="entry-img">
              <div class="portfolio-details-slider swiper">
                <div class="swiper-wrapper align-items-center">

                  <div class="swiper-slide">
                    <img style="width: 98%; height: auto;" data-bs-toggle="modal" data-bs-target="#exampleModal" src="{{ product.image.url }}" alt="">
                  </div>

                  <div class="swiper-slide">
                    <img style="width: 98%; height: auto;" data-bs-toggle="modal" data-bs-target="#exampleModal1" src="{{ product.image2.url }}" alt="">
                  </div>

                  <div class="swiper-slide">
                    <img style="width: 98%; height: auto;" src="{{ product.image3.url }}" alt="">
                  </div>

                </div>
                <div class="swiper-pagination"></div>
              </div>
            </div>

            <h2 class="entry-title">
              <a href="">{{ product.title }}</a>
            </h2>

            <div class="entry-meta">
              <ul>
                <li class="d-flex align-items-center"><i class="bi bi-person"></i><a href="{% url 'visible_profile' product.author.username %}">{{ product.author }}</a></li>
                <li class="d-flex align-items-center"><i class="bi bi-clock"></i> <a href=""><time datetime="2020-01-01">{{ product.created_at }}</time></a></li>
                <li class="d-flex align-items-center"><i class="bi bi-chat-dots"></i> <a href="">{{ cout_reviews }} Comentarios</a></li>
                <li class="d-flex align-items-center"><i class=""></i>
                  <h4>|</h1>
                  </h4>
                  {% if request.user == product.author %}
                    <li style="justify-content: space-between" class="d-flex align-items-center"><i class="bi bi-pen"></i>
                      <a href="{% url 'edit_post' product.id %}">Edit</a></li>
                    <li style="justify-content: space-between" class="d-flex align-items-center"><i class="bi bi-trash"></i>
                      <a href="{% url 'delete' product.id %}">Delete</a></li>
                  {% endif %}
              </ul>
            </div>

            <div class="entry-content">
              <div class="blog-author d-flex align-items-center">
                <div>
                  <h5>Conclucion</h5>
                  <p style="color: rgb(106, 106, 106);">
                    {{ product.content }}
                  </p>
                </div>
              </div><!-- End blog author bio -->
              <p>{{ product.detailed_description|safe }}</p>
            </div>

            <div class="entry-footer">
              <i class="bi bi-folder"></i>
              <ul class="cats">
                <li><a href="{% url 'category_list' product.id %}">{{ product.category }}</a></li>
              </ul>
            </div>

          </article><!-- End blog entry -->

          <div class="blog-comments">
            
            <h4 class="comments-count">{{ cout_reviews }} Comentarios</h4>
            {% if user.is_authenticated %}
              <form method="POST">
                {% csrf_token %}
                {{ form.text }}
                <button type="submit" class="btn btn-primary" style="float: right;">comentar</button>
              </form>
            {% else %}
              <div class="alert alert-primary" role="alert">
                Para comentar, tienes que <a href="{% url 'user_login' %}"><u>iniciar</u></a> sesión
              </div>
            {% endif %}
            <div id="comment-1" class="comment">
              {% for comment in comments %}
                <div class="d-flex">
                  <div class="comment-img"><img src="{{ comment.author.profile.user_image.url }}" alt=""></div>
                  <div>
                    <a href="{% url 'visible_profile' comment.author.username %}">
                      <h5>{{ comment.author }}</h5>
                    </a>
                    <div class="d-flex">
                      <time datetime="2020-01-01">{{ comment.created_at|naturaltime }}</time>
                        {% if request.user == comment.author %}
                        <form method="POST" action="{% url 'comment_delete' comment.pk %}">
                          {% csrf_token %}
                          <button style="margin-top: -10px;" type="submit" class="btn btn-link">
                            <i class="bi bi-trash3"></i>
                          </button>
                        </form>
                        {% endif %}
                    </div>
                    <p>
                      {{ comment.text }}
                    </p>
                    
                  </div>
                </div>
                <button style="margin-left: 8%; background-color: white; padding-bottom: 12px; color: gray;" class="collapsible"><i class="bi bi-caret-down-fill"></i>agregar comentario</button>
                  <div class="content">
                    {% if user.is_authenticated %}
                      <div class="reply-form-container" data-comment-id="{{ comment.id }}">
                        <form action="{% url 'post_detail' product.pk %}" method="POST">
                          {% csrf_token %}
                          {{ reply_form.text }}
                          <input type="hidden" name="comment_id" value="{{ comment.id }}">
                          <div style="padding: 12px;">
                            <button class="btn btn-primary" type="submit" style="float: right;">Responder</button>
                          </div>
                        </form>
                      </div>
                    {% else %}
                      <div class="alert alert-primary" role="alert">
                        Para comentar, tienes que <a href="{% url 'user_login' %}"><u>iniciar</u></a> sesión
                      </div>
                    {% endif %}
                    {% for reply in comment.replies.all %}
                      <div style="padding-left: 6px;" class="d-flex">
                        <div class="comment-img"><img src="{{ reply.author.profile.user_image.url }}" alt=""></div>
                        <div>
                          <a href="{% url 'visible_profile' reply.author.username %}">
                            <h5>{{ reply.author }}</h5>
                          </a>
                          <div class="d-flex">
                            <time datetime="2020-01-01">{{ reply.created_at|naturaltime }}</time>
                            {% if request.user == reply.author %}
                              <form method="POST" action="{% url 'comment_delete' reply.pk %}">
                                {% csrf_token %}
                                <button style="margin-top: -10px;" type="submit" class="btn btn-link">
                                  <i class="bi bi-trash3"></i>
                                </button>
                              </form>
                            {% endif %}
                          </div>
                          <p>
                            {{ reply.text }}
                          </p>
                        </div>
                      </div>
                    {% endfor %}
                  </div>
              {% empty %}
                <p>No comments yet.</p>
              {% endfor %}

            </div><!-- End comment #1 -->

          </div><!-- End blog comments -->
        </div><!-- End blog entries list -->


        <div class="col-lg-4">
          <div class="sidebar">
            <div class="sidebar-item search-form">
              <div class="portfolio-info">
                <h3>Project information</h3>
                <ul>
                  <li><strong>Categoría</strong>: <a href="{% url 'category_list' product.category.pk %}">{{ product.category }}</a></li>
                  <li><strong>Subido</strong>: {{ product.created_at }}</li>
                  <li><strong>Actualisado</strong>: {{ product.updated }}</li>
                  <li><strong>Precio</strong>: ${{ product.get_display_price }}</li>
                </ul>
              </div>
            </div><!-- End sidebar search formn-->
            <div class="card">
              <div class="card-body">
                <center><h4 style="color: green;">${{ product.get_display_price }}</h4></center>
                  <!-- updated form action with product ID/pk as a URL parameter -->
                  <form action="{% url 'create_checkout_session' product.pk %}" method="POST">
                    {% csrf_token %}
                    <button class="btn btn-primary form-control" type="submit" id="checkout-button">Checkout</button>
                  </form>
              </div>
            </div>
          </div><!-- End sidebar recent posts-->

        </div><!-- End sidebar -->

      </div><!-- End blog sidebar -->
    </div>
    </div>
  </section><!-- End Blog Single Section -->
</main><!-- End #main -->
<!-- Modal -->
<div class="modal fade" id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-lg">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="exampleModalLabel">Imagen</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <div id="carouselExampleControls" class="carousel slide" data-bs-ride="carousel">
          <div class="carousel-inner">
            <div class="carousel-item active">
              <img src="{{ product.image.url }}" class="d-block w-100" alt="...">
            </div>
            <div class="carousel-item">
              <img src="{{ product.image2.url }}" class="d-block w-100" alt="...">
            </div>
            <div class="carousel-item">
              <img src="{{ product.image3.url }}" class="d-block w-100" alt="...">
            </div>
          </div>
          <button class="carousel-control-prev" type="button" data-bs-target="#carouselExampleControls" data-bs-slide="prev">
            <span class="carousel-control-prev-icon btn btn-primary" aria-hidden="true"></span>
            <span class="visually-hidden">Previous</span>
          </button>
          <button class="carousel-control-next" type="button" data-bs-target="#carouselExampleControls" data-bs-slide="next">
            <span class="carousel-control-next-icon btn btn-primary" aria-hidden="true"></span>
            <span class="visually-hidden">Next</span>
          </button>
        </div>
      </div>
    </div>
  </div>
</div>
<!-- Modal -->
<div class="modal fade" id="exampleModal1" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-lg">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="exampleModalLabel">Imagen</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <div id="carouselExampleControls2" class="carousel slide" data-bs-ride="carousel">
          <div class="carousel-inner">
            <div class="carousel-item active">
              <img src="{{ product.image2.url }}" class="d-block w-100" alt="...">
            </div>
            <div class="carousel-item">
              <img src="{{ product.image.url }}" class="d-block w-100" alt="...">
            </div>
            <div class="carousel-item">
              <img src="{{ product.image3.url }}" class="d-block w-100" alt="...">
            </div>
          </div>
          <button class="carousel-control-prev" type="button" data-bs-target="#carouselExampleControls2" data-bs-slide="prev">
            <span class="carousel-control-prev-icon btn btn-primary" aria-hidden="true"></span>
            <span class="visually-hidden">Previous</span>
          </button>
          <button class="carousel-control-next" type="button" data-bs-target="#carouselExampleControls2" data-bs-slide="next">
            <span class="carousel-control-next-icon btn btn-primary" aria-hidden="true"></span>
            <span class="visually-hidden">Next</span>
          </button>
        </div>
      </div>
    </div>
  </div>
</div>
<!-- Modal -->
<div class="modal fade" id="exampleModal1" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-lg">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="exampleModalLabel">Imagen</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <div id="carouselExampleControls3" class="carousel slide" data-bs-ride="carousel">
          <div class="carousel-inner">
            <div class="carousel-item active">
              <img src="{{ product.image3.url }}" class="d-block w-100" alt="...">
            </div>
            <div class="carousel-item">
              <img src="{{ product.imag2.url }}" class="d-block w-100" alt="...">
            </div>
            <div class="carousel-item">
              <img src="{{ product.image.url }}" class="d-block w-100" alt="...">
            </div>
          </div>
          <button class="carousel-control-prev" type="button" data-bs-target="#carouselExampleControls3" data-bs-slide="prev">
            <span class="carousel-control-prev-icon btn btn-primary" aria-hidden="true"></span>
            <span class="visually-hidden">Previous</span>
          </button>
          <button class="carousel-control-next" type="button" data-bs-target="#carouselExampleControls3" data-bs-slide="next">
            <span class="carousel-control-next-icon btn btn-primary" aria-hidden="true"></span>
            <span class="visually-hidden">Next</span>
          </button>
        </div>
      </div>
    </div>
  </div>
</div>
<script>
  var coll = document.getElementsByClassName("collapsible");
  var i;
  for (i = 0; i < coll.length; i++) {
    coll[i].addEventListener("click", function() {
      this.classList.toggle("active");
      var content = this.nextElementSibling;
      if (content.style.maxHeight){
        content.style.maxHeight = null;
      } else {
        content.style.maxHeight = content.scrollHeight + "px";
      } 
    });
  }
</script>
{% endblock %}